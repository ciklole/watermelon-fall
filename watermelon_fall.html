<!DOCTYPE html>
<html>
<head>
<title>Watermelon Fall</title>

<style>

	html, body {
		height:100%;
	}

body {
	margin: 0;
	background: linear-gradient(to bottom, skyblue, lightgreen);
	overflow: hidden;
	font-family: Arial, Helvetica, sans-serif;
	cursor: none;
}

#score {
	position:absolute;
	top: 10px;
	left: 10px;
	font-size: 30px;
	font-weight: bold;
	color: white;
	text-shadow: 0 0 10px black;
	z-index: 1000;
}


#slash {
	position: absolute;
	width: 8px;
	height: 8px;
	background: red;
	border-radius: 50%;
	pointer-events: none;
}

.trail {
	position: absolute;
	width: 12px;
	height: 12px;
	background: whitesmoke;
	border-radius: 60%;
	pointer-events: none;
	box-shadow: 0 0 15px whitesmoke, 0 0 30px red;
	animation: fadeOut 0.4s forwards;

}
@keyframes fadeOut {
	to {
		opacity: 0;
		transform:scale(0.5);
	}
	
}
.watermelon {
	width: 80px;
	height: 80px;
	border-radius: 50%;
	position: absolute;
	cursor: pointer;

	background:
		radial-gradient(circle at 30% 30%, #7CFC00, #0d5f0d 70%),
		repeating-linear-gradient(
			90deg,
			#0d5f0d 0px,
			#0d5f0d 8px,
			#145214 8px,
			#145214 16px
		);

	background-blend-mode: multiply;

	box-shadow:
		inset -10px -15px 25px rgba(0,0,0,0.4),
		0px 8px 20px rgba(0,0,0,0.3);

	transition: transform 0.2s;
}

.watermelon:hover {
	transform: scale(1.1);
}

button {
	padding: 12px 20px;
	margin: 8px;
	font-size: 16px;
	font-weight: bold;
	border-radius: 12px;
	border: none;
	cursor: pointer;
	background: green;
	color: white;
	box-shadow: 0 6px 15px darkslategrey;
	transition: all 0.2s ease;
}

button:hover {
	transform: translateY(-3px);
	box-shadow: 0 10px 20px rgba(0,0,0,0.4);
}

button:active {
	transform: scale(0.95);
}


#menumelon {
	width: 140px;
	height: 140px;
	border-radius: 50%;
	background: radial-gradient(circle at 30% 30%, lightgreen, darkgreen);
	border: 8px solid darkgreen;
	box-shadow: 0 20px 40px black;
	margin-bottom: 30px;
	cursor: pointer;
}

#menu {
	position: fixed;
	width: 100%;
	height: 100%;
	background: skyblue;
	display: flex;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	z-index: 20;
	text-align: center;
}


#menu h1 {
	font-size: 50px;
	margin-bottom: 10px;
}

#menu p {
	font-size: 20px;
	margin-bottom: 30px;
}
#knife {
	transform-origin: 10% 90%;
	position: fixed;
    pointer-events: none;
    z-index: 1000;
    transform: rotate(45deg);
    transition: transform 0.1s;
}

@keyframes moveStripes {
	from{
		background-position: 0 0;
	}
	to {
		background-position: 40px 0;
	}
}

/*frost knife*/
.knife-blue {
	width: 70px;
    height: 20px;
    background: linear-gradient(to right, #00c6ff, #0072ff);
    border-radius: 10px;
    box-shadow: 0 0 10px #00c6ff;
}

/*blood-wanted knife*/
.knife-red {
	width: 70px;
    height: 20px;
    background: linear-gradient(to right, darkred, red);
    border-radius: 10px;
    box-shadow: 0 0 10px red;
}

/*sun knife*/
.knife-orange {
	width: 70px;
    height: 20px;
    background: linear-gradient(to right, orange, darkorange);
    border-radius: 10px;
    box-shadow: 0 0 10px orange;
}

/*candy-cane knife*/
.candy-cane {
    width: 20px;
    height: 70px;
	background:repeating-linear-gradient(
	  45deg,               /* Diagonal angle */
      #F73B3E,             /* Red stripe start */
      #F73B3E 20px,        /* Red stripe thickness */
      #FFFFFF 20px,        /* White stripe start */
      #FFFFFF 40px         /* White stripe thickness */);
	  background-size: 40px 40px;
	  animation:  moveStripes 3s linear infinite;
	border-radius: 15px;
    position: relative;
}
/*found how to do it on web XD*/
.candy-cane::before {
    content: "";
    position: absolute;
    width: 40px;       /* diameter of curve */
    height: 40px;
    border-radius: 50%; /* makes a circle */
	background:repeating-linear-gradient(
	  45deg,               /* Diagonal angle */
      #F73B3E,             /* Red stripe start */
      #F73B3E 20px,        /* Red stripe thickness */
      #FFFFFF 20px,        /* White stripe start */
      #FFFFFF 40px         /* White stripe thickness */);
	  background-size: 40px 40px;
	  animation:  moveStripes 3s linear infinite;
    
    /* Show only the top-left quarter of the circle */
    clip-path: polygon(0 0, 100% 0, 100% 50%, 50% 50%, 50% 100%, 0 100%);
}

@keyframes shake {
    0% { transform: translate(0px, 0px); }
    25% { transform: translate(3px, -3px); }
    50% { transform: translate(-3px, 3px); }
    75% { transform: translate(3px, 3px); }
    100% { transform: translate(0px, 0px); }
}

.hit {
    animation: shake 0.15s;
}

@keyframes explodeJuice {
    0% {
        transform: scale(1);
        opacity: 1;
    }
    100% {
        transform: scale(1.5);
        opacity: 0;
    }
}

.explode {
    animation: explodeJuice 0.6s forwards;
}

.juice {
    position: absolute;
    width: 8px;
    height: 8px;
    background: red;
    border-radius: 50%;
    pointer-events: none;
}
#bossBar {
	display: none;
	position: absolute;
	top: 15px;
	left: 50%;
	transform: translateX(-50%);
	width: 400px;
	height: 25px;
	background: #111;
	border-radius: 20px;
	box-shadow: 0 0 20px red;
	overflow: hidden;
}

#bossHealth {
	height: 100%;
	width: 100%;
	background: linear-gradient(to right, red, darkred);
	transition: width 0.2s;
}




@keyframes shine {
    0% { left: -30px; }
    100% { left: 100%; }
}

#warningText {
    position: fixed;
    top: 40%;
    width: 100%;
    text-align: center;
    font-size: 60px;
    font-weight: bold;
    color: red;
    text-shadow: 0 0 20px black;
    display: none;
    z-index: 2000;
}


.melonHealth {
    position: absolute;
    top: -10px;
    left: 0;
    width: 80px;
    height: 6px;
    background: #333;
    border-radius: 5px;
    overflow: hidden;
}

.melonHealthFill {
    height: 100%;
    width: 100%;
    background: limegreen;
    transition: width 0.2s;
}

@keyframes screenShake {
  0% { transform: translate(0); }
  25% { transform: translate(5px, -5px); }
  50% { transform: translate(-5px, 5px); }
  75% { transform: translate(5px, 5px); }
  100% { transform: translate(0); }
}

#comboText {
	position:absolute;
	top: 50px;
	left: 10px;
	font-size: 22px;
	color: yellow;
	font-weight: bold;
	text-shadow: 0 0 10px black;
}

#bossBar {
	display: none;
	position: absolute;
	top: 10px;
	left: 50%;
	transform: translateX(-50%);
}


</style>
</head>
<body>

<div id="comboText"></div>

<div id = "menu">
	<h1>Watermelon Fall</h1>
	<p>Slash the Watermelon to start XD</p>
	<div id = "menumelon"></div>


	<div id = "Skins">
		<button onclick="setKnife('blue')">Cold Knife</button>
		<button onclick="setKnife('red')">Blood-Wanted Knife</button>
		<button onclick="setKnife('orange')">Sun-like Knife</button>
		<button onclick="setKnife('candy')">Candy-Cane Knife</button>
		<hr>
		<h3>Maps</h3>
		<button onclick="setMap('normal')">Normal</button>
		<button onclick="setMap('xmas')">Xmas</button>
		<button onclick="setMap('halloween')">Halloween</button>

		</div>
</div>	
<div id="score">Score: 0  </div>
<div id="warningText"></div>
<div id="knife"></div>

<div id="bossBar">
  <div id="bossHealth"></div>
</div>

<script>
let score = 0;
let killCount = 0;
let scoreText = document.getElementById("score");
let knife = document.getElementById("knife")
let nextBossAt = getRandomBossNumber();
let bossActive = false;
let normalMusic = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_8f4c4dbe62.mp3");
let bossMusic = new Audio("https://cdn.pixabay.com/download/audio/2022/10/25/audio_1c14a9b41f.mp3");
let sliceSound = new Audio("https://cdn.pixabay.com/download/audio/2022/03/24/audio_c8633d6b1a.mp3");
let sliceCooldown = false;
let currentMap = "normal";
let combo = 0;
let comboTimer;
let slowMode = false;

normalMusic.loop = true;
bossMusic.loop = true;

function getRandomBossNumber() {
    return Math.floor(Math.random() * 21) + 20; 
}

document.addEventListener("mousemove", function(e) {
    knife.style.left = (e.clientX - 15) + "px";
    knife.style.top = (e.clientY - 60) + "px";

    if (isSlicing) {
        knife.style.transform = "rotate(120deg)";
        setTimeout(() => {
            knife.style.transform = "rotate(45deg)";
        }, 100);
    }
});

knife.style.left = "100px";
knife.style.top = "100px";

function spawnWatermelons() {
	for (let i = 0; i < 3; i++) {
		createWatermelon();
	}
}

document.addEventListener("keydown", function(e){
    if (e.key === "Shift" && !slowMode) {
        activateSlowMo();
    }
});

//if hold shift, slow-motion will appear
function activateSlowMo() {

    slowMode = true;
    document.body.style.filter = "blur(2px)";

    let allMelons = document.querySelectorAll(".watermelon");

    allMelons.forEach(m => {
        m.style.transition = "top 1s linear";
    });

    setTimeout(() => {
        document.body.style.filter = "";
        slowMode = false;
    }, 3000);
}


function setMap(type) {
    currentMap = type;

    if (type === "normal") {
        document.body.style.background =
            "linear-gradient(to bottom, skyblue, lightgreen)";
    }

    if (type === "xmas") {
        document.body.style.background =
            "linear-gradient(to bottom, #002244, #004400)";
    }

    if (type === "halloween") {
        document.body.style.background =
            "linear-gradient(to bottom, black, darkorange)";
    }
}


function createJuice(x, y) {
    for (let i = 0; i < 12; i++) {
        const drop = document.createElement("div");
        drop.classList.add("juice");
        document.body.appendChild(drop);

        drop.style.left = x + "px";
        drop.style.top = y + "px";

        const angle = Math.random() * Math.PI * 2;
        const distance = Math.random() * 100;

        const dx = Math.cos(angle) * distance;
        const dy = Math.sin(angle) * distance;

        drop.animate([
            { transform: "translate(0,0)", opacity: 1 },
            { transform: `translate(${dx}px, ${dy}px)`, opacity: 0 }
        ], {
            duration: 600,
            easing: "ease-out"
        });

        setTimeout(() => drop.remove(), 600);
    }
}


function setKnife(type) {
    knife.className = "";
    knife.dataset.trail = type;

    if (type === "blue") {
        knife.classList.add("knife-blue");
    }
    else if (type === "red") {
        knife.classList.add("knife-red");
    }
    else if (type === "orange") {
        knife.classList.add("knife-orange");
    }
    else if (type === "candy") {
        knife.classList.add("candy-cane");
    }
}

setKnife("blue");

function createWatermelon() {
	let melon = document.createElement("div");
	melon.classList.add("watermelon");
	melon.dataset.hp = 3;
	melon.dataset.maxhp = 3; // normal melons have 3 HP
	melon.style.left = Math.random() * (window.innerWidth - 60) + "px";
	melon.style.top = "0px";
	document.body.appendChild(melon);
	applyMelonDesign(melon);
	let healthBar = document.createElement("div");
	healthBar.classList.add("melonHealth");

	let healthFill = document.createElement("div");
	healthFill.classList.add("melonHealthFill");

	healthBar.appendChild(healthFill);
	melon.appendChild(healthBar);


	let position = 0;
	let fall = setInterval(function() {
		position += 5;
		melon.style.top = position +"px"

		if (position  > window.innerHeight){
		melon.remove();
		clearInterval(fall);
		}
	}, 30);


//slice the very yummy watermelon XD
melon.addEventListener("click", function()  {
	melon.style.transform = "scale(1.3)";
	melon.style.background = "red";
	score++	;

	scoreText.innerText = "Score: " + score;
	
})
}

let isSlicing = false;
document.addEventListener("mousedown", function(){
	isSlicing = true;
});

document.addEventListener("mouseup", function() {
	isSlicing = false;
});

document.addEventListener("mousemove", function(event) {
	if (isSlicing) {
		checkSlice(event.clientX, event.clientY);
		createTrail(event.clientX, event.clientY);
	}
});

//watermelivees and destroy
function destroyWatermelon(melon) {
    const rect = melon.getBoundingClientRect();
    createJuice(rect.left + rect.width / 2, rect.top + rect.height / 2);

    melon.classList.add("explode");

    setTimeout(() => {
        if (melon.classList.contains("boss")) {
			document.getElementById("bossBar").style.display = "none";
            bossActive = false;
			bossMusic.pause();
    		normalMusic.play();
        }
        melon.remove();
    }, 600);
}



function checkSlice(x, y){
	let menuMelon = document.getElementById("menumelon");
	
	if (sliceCooldown) return;

	sliceCooldown = true;
	setTimeout(() => {
	    sliceCooldown = false;
	}, 100);
	
	if (menuMelon) {
		let rect = menuMelon.getBoundingClientRect();

		if (
			x > rect.left &&
			x < rect.right &&
			y < rect.bottom &&
			y > rect.top
		) {
			startGame();
		}
	}

	let melons = document.querySelectorAll(".watermelon");
	melons.forEach(function(melon) {
		let rect = melon.getBoundingClientRect();

		if (
			x > rect.left &&
			x < rect.right &&
			y > rect.top &&
			y < rect.bottom 
		) {
			let currentHP = parseInt(melon.dataset.hp);
			currentHP--;
			sliceSound.currentTime = 0;
			sliceSound.play();
			melon.dataset.hp = currentHP;
			melon.classList.add("hit");
			setTimeout(() => melon.classList.remove("hit"), 150);

			let healthFill = melon.querySelector(".melonHealthFill");
			let maxHP = parseInt(melon.dataset.maxhp);
			healthFill.style.width = (currentHP / maxHP) * 100 + "%";


			if (currentHP <= 0 && !melon.classList.contains("dead")) {
				melon.classList.add("dead");
				destroyWatermelon(melon);

    			score++;
    			killCount++;
				combo++;
				clearTimeout(comboTimer);
				let comboText = document.getElementById("comboText");
				comboText.innerText = combo >= 2 ? " Combo x" + combo : "";
				if (combo >= 5) {
					document.body.style.background = "white";
					setTimeout(() => {
						setMap(currentMap);
					}, 100);
				}


				comboTimer = setTimeout(() => {
    				combo = 0;
					document.getElementById("comboText").innerText = "";
				}, 1500);

				if (combo >= 3) {
    				score += combo; // bonus points
				}


    			scoreText.innerText = "Score: " + score;

    			if (!melon.classList.contains("boss")) {
        			if (!bossActive && killCount >= nextBossAt) {
            			spawnBoss();
            			nextBossAt = killCount + getRandomBossNumber();
        }
    }
	if (melon.classList.contains("boss")) {
	let bossBar = document.getElementById("bossHealth");
	let maxHP = parseInt(melon.dataset.maxhp);
	let currentHP = parseInt(melon.dataset.hp);
	bossBar.style.width = (currentHP / maxHP) * 100 + "%";
}

}

		}
	});
}

function spawnBoss() {
	document.getElementById("bossBar").style.display = "block";
    if (bossActive) return;  // safety lock
	normalMusic.pause();
	bossMusic.currentTime = 0;
	bossMusic.play();

    bossActive = true;

    let warning = document.getElementById("warningText");

    warning.innerText = "!BOSS IS COMING!";
    warning.style.display = "block";
	document.body.style.animation = "screenShake 0.4s";
	setTimeout(() => {
    	document.body.style.animation = "";
	}, 400);

    document.body.style.animation = "shake 0.5s";

    setTimeout(() => {
        document.body.style.animation = "";
        warning.style.display = "none";
        createBossWatermelon();
    }, 2000);
}


function createBossWatermelon() {
    let melon = document.createElement("div");
    melon.classList.add("watermelon");
	applyMelonDesign(melon);
    melon.style.width = "150px";
    melon.style.height = "150px";
    melon.style.background =
        "radial-gradient(circle at 30% 30%, #ff4d4d, #660000)";

   	melon.dataset.maxhp = 15;
	melon.dataset.hp = 15;
	melon.classList.add("boss");
    melon.style.left = (window.innerWidth / 2 - 75) + "px";
    melon.style.top = "50px";

    document.body.appendChild(melon);

    // add boss health bar
    let healthBar = document.createElement("div");
    healthBar.classList.add("melonHealth");
    healthBar.style.width = "150px";

    let healthFill = document.createElement("div");
    healthFill.classList.add("melonHealthFill");

    healthBar.appendChild(healthFill);
    melon.appendChild(healthBar);
	setTimeout(() => {
    	if (document.body.contains(melon)) {
        	melon.style.background = "black";
        	melon.style.boxShadow = "0 0 40px red";
    	}
	}, 10000);

	let shootInterval = setInterval(() => {

    	if (!document.body.contains(melon)) {
        	clearInterval(shootInterval);
        	return;
    	}

    	shootSeed(melon);

	}, 1500);


}

function shootSeed(boss) {

    let seed = document.createElement("div");
    seed.style.position = "absolute";
    seed.style.width = "10px";
    seed.style.height = "10px";
    seed.style.background = "black";
    seed.style.borderRadius = "50%";

    document.body.appendChild(seed);

    let rect = boss.getBoundingClientRect();

    let x = rect.left + rect.width / 2;
    let y = rect.top + rect.height / 2;

    seed.style.left = x + "px";
    seed.style.top = y + "px";

    let angle = Math.random() * Math.PI * 2;
    let speed = 5;

    let move = setInterval(() => {
        x += Math.cos(angle) * speed;
        y += Math.sin(angle) * speed;

        seed.style.left = x + "px";
        seed.style.top = y + "px";

        if (
            x < 0 || x > window.innerWidth ||
            y < 0 || y > window.innerHeight
        ) {
            clearInterval(move);
            seed.remove();
        }

    }, 30);
}


function applyMelonDesign(melon) {

    if (currentMap === "normal") {
        melon.style.background =
            "radial-gradient(circle at 30% 30%, #56c556, #0d5f0d)";
    }

    if (currentMap === "xmas") {
        melon.style.background =
            "radial-gradient(circle at 30% 30%, red, darkred)";
        melon.innerText = "ðŸŽ„";
        melon.style.fontSize = "40px";
        melon.style.display = "flex";
        melon.style.alignItems = "center";
        melon.style.justifyContent = "center";
    }

    if (currentMap === "halloween") {
        melon.style.background =
            "radial-gradient(circle at 30% 30%, orange, darkorange)";
        melon.innerText = "ðŸŽƒ";
        melon.style.fontSize = "40px";
        melon.style.display = "flex";
        melon.style.alignItems = "center";
        melon.style.justifyContent = "center";
    }
}



function startGame() {
	document.getElementById("menu").style.display = "none";
	setInterval(spawnWatermelons, 3000)
	normalMusic.play();
}

function createTrail(x, y) {
    let trail = document.createElement("div");
    trail.classList.add("trail");

    let color = "white";

    if (knife.dataset.trail === "blue") color = "#00c6ff";
    if (knife.dataset.trail === "red") color = "red";
    if (knife.dataset.trail === "orange") color = "orange";
    if (knife.dataset.trail === "candy") color = "#F73B3E";

    trail.style.background = color;
    trail.style.boxShadow = `0 0 15px ${color}, 0 0 30px ${color}`;

    trail.style.left = x + "px";
    trail.style.top = y + "px";

    document.body.appendChild(trail);

    setTimeout(() => {
        trail.remove();
    }, 400);
}


</script>
</body>
</html>
